image: fedora:31

stages:
  - test

before_script:
  - dnf install -y which diffutils make file git python3-devel gettext-devel libappstream-glib intltool libxml2-devel itstool json-glib-devel libnotify-devel yelp-tools gstreamer1-devel libgudev-devel python3-gobject-devel gstreamer1-plugins-base-devel libmtp-devel libpeas-devel libgpod-devel brasero-devel libtdb-devel libsoup-devel gobject-introspection-devel grilo-devel gtk3-devel libdmapsharing-devel libsecret-devel totem-pl-parser-devel gtk-doc xorg-x11-server-Xvfb librsvg2

test:
  stage: test
  script:
    - mkdir build
    - cd build
    - NOCONFIGURE=1 ../autogen.sh
    - ../configure --disable-daap
    - make
    - make install
    - xvfb-run -a -s "-screen 0 1024x768x24" make check
  artifacts:
    paths:
      - build/config.log
      - build/tests/*.log
    when: always
